<!DOCTYPE html>
<html>
<head>
	<title>Arachnid</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<style type="text/css">
/******************************************************************************
* ArachnidJS                                                                  *
* (C) AlainArachnid GPL V2                                                    *
* see https://github.com/AlainArachnid/ArachnidJS                             *
*                                                                             *
* Initial cards library & css: Copyright 2001 by Mike Hall                    *
* Please see http://www.brainjar.com for terms of use.                        *
******************************************************************************/

/******************************************************************************
* TODO
* restore
* fix bug on chrome/android
* help in English
******************************************************************************/
	</style>
	<!-- icon extracted from the legacy 16 bits arachnid.exe -->
	<link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,AAABAAEAICAQAAEABADoAgAAFgAAACgAAAAgAAAAQAAAAAEABAAAAAAAgAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAACAAAAAgIAAgAAAAIAAgACAgAAAgICAAMDAwAAAAP8AAP8AAAD//wD/AAAA/wD/AP//AAD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////AAAAAAAAAAAAD//////5nwAAAAAAAAAAAA//////+Z8AAAAAAAAAAAAP///5//mfAAAAAAAAAAAAD///mZ///wAAAAAAAAAAAA//+ZmZ//8AAAAAAAAAAAAP//+Zn///AAAAAAAAAAAAD///+f///wAAAAAAAAAAAA////////8AAAAAAAAAAAAP////////AAAAAAAAAAAAD////////wAAAAAAAAAAAA////////8AAAAAAAAAAAAP////////AAAAAAAAAAAAD////////wAAAAAAAAAAAA////////8AAAAAAAAAAAAP////////AAAAAAAAAAAAD///+f///wAAAAAAAAAAAA///5mf//8AAAAAAAAAAAAP//mZmf//AAAAAAAAAAAAD///mZ///wAAAAAAAAAAAA+Z//n///8AAAAAAAAAAAAPmf//////AAAAAAAAAAAAD5n//////wAAAAAAAAAAAA////////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//////////////////////4AA//+AAP/vgAD774AA++8AAHv2gAC3+YAAz/+AAP/vgAD774AA++8AAHv2gAC3+YAAz/+AAP/vgAD774AA++8AAHv2gAC3+YAAz/+AAP/vgAD774AA++8AAHv2gAC3+YAAz/+AAP///////////wAAAAAAAAAAAADC3G9ouH8AAMrcb2i4fwAAAAAAAAEBAAAwAwAAAAA=" />
	<style type="text/css">
html, body {
	height:100%;
	margin:0px;
	padding:0px;
	font-family: Sans-Serif;
}

#bkground {
	top: 0;
	bottom: 0;
	left: 0;
	width:1040px;
	background-color:green;
	position: absolute;
	overflow-y: hidden;	/* avoid vertical scroll. Long columns are compressed */
	overflow-x: hidden;	/* avoid horizontal scroll */
	-webkit-touch-callout: none;	/* help something on iPhone */
	touch-action: none;	/* prevent the default touch for edge and IE on touch devices */
	-ms-touch-action: none;
}

#logdebug {
	position: absolute;
	bottom: 0;
	left: 0;
}

.but, .butFlashed, .butGrayed {
	position: absolute;
	border: solid blue 2px;
	cursor: pointer;
	padding: 5px;
}

.but {
	background-color: #D0D0D0;
	top: 10px;
	border-radius: 10px;
}

.butFlashed {
	background-color: black;
	top: 10px;
	border-radius: 10px;
}

.butGrayed {
	background-color: #808080;
	top: 10px;
	border-radius: 10px;
}

.topinfo {
	position: absolute;
	padding: 5px;
	color: white;
	top: 13px;
}

#deal {
	left: 10px;
}

#new {
	right: 20px;
}

#easydiv {
	position: absolute;
	color: white;
	top: 7px;
	right: 120px;
	text-align: center;
}

#save {
	left: 330px;
}

#restore {
	left: 390px;
}

#undo {
	left: 470px;
}

#help {
	left: 530px;
	background-color: #40C040;
}

#dealt {
	left: 100px;
}

#elapsed {
	left: 140px;
}

#moves {
	left: 220px;
	width: 90px;
	text-align: right;
}

#win {
	position: absolute;
	border: solid blue 2px;
	display: none;
	left: 0;
	right: 0;
	margin-left: auto; 
	margin-right: auto; 
	top: 120px;
	xleft: 300px;
	width: 50%;
	xmargin: 0 auto;
	font-size: 100px;
	z-index: 99999;
	background-color: purple;
	color: white;
}

#help-all {
	position: absolute;
	border: solid blue 2px;
	display: none;
	left: 50;
	right: 50;
	top: 50px;
	margin: 15px;
	padding : 10px;
	font-size: 20px;
	z-index: 99999;
	background-color: #40C040;
	color: white;
}

#help-close {
	position: absolute;
	top: 0;
	right: 5px;
	cursor: pointer;
}

.column {
	position: absolute;
	width: 100px;
	top: 50px;
	bottom: 0;
}

.cardHidden {
	/*background-image: url("cardback.gif");*/
	background-image: url(data:image/gif;base64,R0lGODlhDAAQAPcAAMAAAMABAcACAsADA8EEBMEGBsUUFMUWFsUXF8YYGMYZGcYaGsYbG8ccHMcdHcceHscfH8ggIMgjI848PM8/P9BAQNBCQtBERNFGRtFHR9JJSdJKStJLS9JMTNNNTdNPT9RTU956et+AgOCCguCEhOGIiOKKiuKLi+ORke23t+67u+68vO++vu+/v+/BwfDCwvDDw/DExPDFxfHGxvHHx/HIyPHJyfLMzPjj4/jl5fjm5vnn5/no6Pnp6fnq6vrr6/rs7Prt7fru7vvv7/36+v77+/78/P79/f7+/gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAADAAQAEAIkACLVABAsCDBCUQMWjByJINBgieMXCBIoQiKghiMmDBI4ggHABCCrBBgMECKIRIKOvjRQoWQCA8HsADygIEPGAQIuvjR4CEABTxm1NCBwKcBHDcAeDgiwmAIJCAKEpDBQ8GBHDYK+NxwBMkHnwAS7KDxwgeDhyOOdCCY4UgJggt6xMhZcEALmkc0gAVwwUhAAAA7);
	border-color: #808080 #000000 #000000 #808080;
	border-width: 1px;
	border-style: solid;
	font-size: 20pt;
	position: absolute;
	width:  100px;
	height: 133px;
	border-radius: 5px;
}

.cardHidden div, .cardHidden img {
	display: none!important;
}

.cardFlashed {
	background-color: black;
	border-color: #808080 #000000 #000000 #808080;
	border-width: 1px;
	border-style: solid;
	font-size: 20pt;
	position: absolute;
	width:  100px;
	height: 133px;
}

.cardFlashed div, .cardFlashed img {
	display: none!important;
}

.cardVisible {
	border-color: #808080 #000000 #000000 #808080;
	border-width: 1px;
	border-style: solid;
	font-size: 20pt;
	position: absolute;
	width:  100px;
	height: 133px;
	border-radius: 5px;
}

.front {
	background-color: #ffffff;
	color: #000000;
	position: absolute;
	width: 100%;
	height: 100%;
	border-radius: 5px;
}

.red { color: #ff0000; }

.terminatedSuit {
	position: absolute;
	color: transparent;
	font-size: 20pt;
	top: 10px;
	border: solid white 1px;
	width: 20px;
	text-align: center;
	border-radius: 3px;
}

.index, .index2 {
	font-size: 50%;
	font-weight: bold;
	text-align: center;
	position: absolute;
	top:  0.25em;
}

.index {
	left: 0.25em;
}

.index2 {
	right: 0.25em;
}

.ace {
	font-size: 300%;
	position: absolute;
	width: 100%;
	text-align: center;
	top:  0.200em;
}

.face {
	border: 1px solid #000000;
	position: absolute;
	left: 0.50em;
	top:  0.45em;
	width:  2.6em;
	height: 4.0em;
}

.spotA1 { position: absolute; left: 0.60em; top: 0.5em; }
.spotA2 { position: absolute; left: 0.60em; top: 1.5em; }
.spotA3 { position: absolute; left: 0.60em; top: 2.0em; }
.spotA4 { position: absolute; left: 0.60em; top: 2.5em; }
.spotA5 { position: absolute; left: 0.60em; top: 3.5em; }

.spotB1 { position: absolute; left: 1.55em; top: 0.5em; }
.spotB2 { position: absolute; left: 1.55em; top: 1.0em; }
.spotB3 { position: absolute; left: 1.55em; top: 2.0em; }
.spotB4 { position: absolute; left: 1.55em; top: 3.0em; }
.spotB5 { position: absolute; left: 1.55em; top: 3.5em; }

.spotC1 { position: absolute; left: 2.50em; top: 0.5em; }
.spotC2 { position: absolute; left: 2.50em; top: 1.5em; }
.spotC3 { position: absolute; left: 2.50em; top: 2.0em; }
.spotC4 { position: absolute; left: 2.50em; top: 2.5em; }
.spotC5 { position: absolute; left: 2.50em; top: 3.5em; }
	</style>
	<script>
/******************************************************************************
* ArachnidJS                                                                  *
*                                                                             *
* Do not remove this notice.                                                  *
*                                                                             *
* Copyright 2014 Alain Brion                                                  *
* Card library by Mike Hall                                                   *
* http://www.brainjar.com/common/viewsource.asp?source=\js\cards\cards.js     *
* Release under GPL xxxxx                            .                        *
******************************************************************************/

// Config
const ALLOW_UNDO_HIDE_EASYMODE = true;

//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
// Documentation on JS objects
//
/////////////////////////////////
//	Card
/////////////////////////////////
//	Constructor
//		Card(rank, suit)
//	Properties
//		rank: 1 (ace) to 13 (king)
//		suit: "Clubs" or "Diamonds" or "Hearts" or "Spades"
//		spacing: distance between top of one card and top of the underlying card
//	Methods
//		setColumn(oCol, iPos): link to column oCol at position iPos
//		flash(): flash the card (indicate move impossible)
//		unhide()
//		cardToString(): Returns the name of a card (including rank and suit) as a text string
//		createNode(): Returns a DIV node which can be used to display the card on a page.
//		match(other): returns true if same card and same visible/hidden
//
/////////////////////////////////
//	Stack : used for desk (that is: cards that are not in columns), for columns and for straights
/////////////////////////////////
//	Constructor
//		Stack()
//	Properties
//		cards: array of card objects
//	Methods
//		clear(): empty stack (handle DHTML objects)
//		draw(n):	Removes the first card in the stack and returns it (not used)
//		addCard(oCard):	Adds the given card to the stack, returns the index of the card in the stack
//		combine(oOther):	Adds the cards in the given stack to the current one, the given stack (oOther) is emptied. (not used)
//		cardCount():	Returns the number of cards currently in the stack
//		lastCard():	Returns last card's object
//	(specific to desk)
//		makeDeck(n): Initializes a stack using n packs of cards
//		shuffle(n):	Shuffles a stack of cards 'n' times
//		deal():	Removes the first card in the stack and returns it
//	(specific to column)
//		mkColumn(n): upgrade a Stack object into column by linking to the <div> for this column
//		findBottomStraight(): find last card and its straight, return a Stack object
//		click(): handle the click event on column
//		unhideLast(): unhide last card
//		isSuitable(newCard, mode) : return boolean, true if the card is suitable to this column
//				mode=0 same suit
//				mode=1 any suit
//				mode=2 empty columns
//				mode=99 any mode
//		respace() : Re compute vertical spacing if needed
//	(specific to straight)
//		moveStraight(oStraight, oCol): Move a straight (oStraight) from this column into an other (oCol). Remove only if oCol is absent
//		flashAll(): Flash all cards

//
/////////////////////////////////
//	DragDrop
/////////////////////////////////
//	Constructor
//		DragDrop(ev):	ev is the argument of a mouseDown event
//	Properties
//		oCol:	stack object for the "from" column
//		straight: stack object for the straight being dragged
//		xOffset : offset between mouse pointer and left of card when dragging
//		yOffset : offset between mouse pointer and top of card when dragging
//	Methods
//		mouseUp(ev):	handled the mouseUp event, drop the strait
//		moveBackOrig():	returns the straight to its original position
//		doClick():	handles a click (case when the user "clicks", this is NOT a drag'n drop)
//		mouseMove(ev):	handled a move of the mouse
//		moveTo(oPos):	moves the straight to the specified position (oPos has x & y properties)
//
/////////////////////////////////
//	Static functions
/////////////////////////////////
//		mouseCoords(ev):	returns an object with x & y properties (coord of the click for the ev, which is the argument of a mouseXXX event)
//		initA():		initialization (body.onload)
//		dealRow():		deal a row (add a card taken from desk into each column)
//		showDealt():	display the count of already dealt
//		newGame():		new game
//		mouseUp(ev), mouseMove(ev), mouseDown(ev)	mouse handlers (on whole HTML page)
//
//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++


//=============================================================================
// Card Object (derived from by Mike Hall work)
//	Alain : changed the rank property from a string ('1' to '9', 'K', etc.) to numeric (1 to 9, 11=J, 12=D, 13=K), easier to handle straights
//=============================================================================

//-----------------------------------------------------------------------------
// Card constructor function.
//-----------------------------------------------------------------------------

function Card(rank, suit) {
	this.rank = rank;
	this.suit = suit;
	this.spacing = 40;
}

//-----------------------------------------------------------------------------
//returns true if same card and same visible/hidden
//-----------------------------------------------------------------------------
Card.prototype.match = function(other) {
	//console.log(other.cardToDebug() + ' vs ' + this.cardToDebug());
	if (other.rank != this.rank) return false;
	if (other.suit != this.suit) return false;
	if (other.visible != this.visible) return false;
	return true;
}

//-----------------------------------------------------------------------------
// link to a column
// ARGS
//	oCol : HTML div element
//	iPos : position of the card into the column
//-----------------------------------------------------------------------------
Card.prototype.setColumn = function(oCol, iPos) {
	//console.log('set oCol(' + oCol.elt.id + ') to card ' + this.cardToString());
	this.oCol = oCol;
	if (this.elt == undefined) {
		this.elt = this.createNode();
		this.elt.oCard = this;	// back link from HTML element to javascript object
	}
	if (this.elt.parentNode) this.elt.parentNode.removeChild(this.elt);
	oCol.elt.appendChild(this.elt);
	this.elt.style.top = (iPos * this.spacing) + 'px';
	this.elt.style.left = 0;
	this.elt.style.zIndex = iPos;
}

//-----------------------------------------------------------------------------
// remove from the deck
//-----------------------------------------------------------------------------
Card.prototype.remove = function() {
	if (this.elt.parentNode) this.elt.parentNode.removeChild(this.elt);
}

//-----------------------------------------------------------------------------
// flash a card (indicate move impossible)
//-----------------------------------------------------------------------------
Card.prototype.flash = function() {
	var elt = this.elt;
	elt.className = 'cardFlashed';
	window.setTimeout(function() {elt.className = 'cardVisible';}, 100);
	window.setTimeout(function() {elt.className = 'cardFlashed';}, 200);
	window.setTimeout(function() {elt.className = 'cardVisible';}, 300);
}

//-----------------------------------------------------------------------------
// unhide a card
//-----------------------------------------------------------------------------
Card.prototype.unhide = function() {
	var elt = this.elt;
	elt.className = 'cardVisible';
	this.visible = true;
}

//-----------------------------------------------------------------------------
// cardToChar(): Returns a letter representative of the card (for saving)
//-----------------------------------------------------------------------------
Card.prototype.cardToChar = function() {
	switch (this.suit) {
	case "C" :
		return  String.fromCharCode(64 + this.rank);	// ace will be 'A', king will be 'M'
	case "D" :
		return  String.fromCharCode(77 + this.rank);	// ace will be 'N', king will be 'Z'
	case "H" :
		return  String.fromCharCode(96 + this.rank);	// ace will be 'a', king will be 'm'
	case "S" :
		return  String.fromCharCode(109 + this.rank);	// ace will be 'n', king will be 'z'
	}
}

//-----------------------------------------------------------------------------
// cardToString(): Returns the card as "3CH" for "3 of clubs, hidden"
//-----------------------------------------------------------------------------
Card.prototype.cardToDebug = function() {
	return this.rank + this.suit + (this.visible ? 'V' : 'H');
}

//-----------------------------------------------------------------------------
// cardToString(): Returns the name of a card (including rank and suit) as a
// text string.
//-----------------------------------------------------------------------------
Card.prototype.cardToString = function() {
	var rank, suit;

	switch (this.rank) {
	case 1 :
		rank = "Ace";
		break;
	case 2 :
		rank = "Two";
		break;
	case 3 :
		rank = "Three";
		break;
	case 4 :
		rank = "Four";
		break;
	case 5 :
		rank = "Five";
		break;
	case 6 :
		rank = "Six";
		break;
	case 7 :
		rank = "Seven";
		break;
	case 8 :
		rank = "Eight";
		break;
	case 9 :
		rank = "Nine";
		break;
	case 10 :
		rank = "Ten";
		break;
	case 11 :
		rank = "Jack"
		break;
	case 12 :
		rank = "Queen"
		break;
	case 13 :
		rank = "King"
		break;
	default :
		rank = null;
		break;
	}

	switch (this.suit) {
	case "C" :
		suit = "Clubs";
		break;
	case "D" :
		suit = "Diamonds"
		break;
	case "H" :
		suit = "Hearts"
		break;
	case "S" :
		suit = "Spades"
		break;
	default :
		suit = null;
		break;
	}

	if (rank == null || suit == null)
	return "";

	return rank + " of " + suit;
}

//-----------------------------------------------------------------------------
// cardCreateNode(): Returns a DIV node which can be used to display the card 
// on a page.
//-----------------------------------------------------------------------------

Card.prototype.createNode = function() {
	var cardNode, frontNode, indexNode, spotNode, tempNode, textNode;
	var indexStr, spotChar;

	// This is the main node, a DIV tag.

	cardNode = document.createElement("DIV");
	cardNode.className = "cardHidden";	// always create hidden, use unhide() to show
	cardNode.oncontextmenu = returnFalse;

	// Build the front of card.

	frontNode = document.createElement("DIV");
	frontNode.className = "front";
	frontNode.oncontextmenu = returnFalse;	// disable context menu because we use left button to do splitted drag'n drop

	// Get proper character for card suit and change font color if necessary.

	spotChar = "\u00a0";
	switch (this.suit) {
	case "C" :
		spotChar = "\u2663";
		break;
	case "D" :
		frontNode.className += " red";
		spotChar = "\u2666";
		break;
	case "H" :
		frontNode.className += " red";
		spotChar = "\u2665";
		break;
	case "S" :
		spotChar = "\u2660";
		break;
	}

	// Create and add the index (rank) to the upper-left corner of the card.

	indexStr = this.rank;
	if (this.toString() == "")
		indexStr = "\u00a0";
	else switch (this.rank) {
		case 11: indexStr = 'J'; break;
		case 12: indexStr = 'Q'; break;
		case 13: indexStr = 'K'; break;
	}
	spotNode = document.createElement("DIV");
	spotNode.className = "index";
	textNode = document.createTextNode(indexStr);
	spotNode.appendChild(textNode);
	// moved to upper right, to be deleted
	//spotNode.appendChild(document.createElement("BR"));
	//textNode = document.createTextNode(spotChar);
	//spotNode.appendChild(textNode);
	frontNode.appendChild(spotNode);

	// small indicator of suit upper right, so that it is still visible when columns are compressed
	spotNode = document.createElement("DIV");
	spotNode.className = "index2";
	textNode = document.createTextNode(spotChar);
	spotNode.appendChild(textNode);
	frontNode.appendChild(spotNode);

	// Create and add spots based on card rank (Ace through 10).

	spotNode = document.createElement("DIV");
	textNode = document.createTextNode(spotChar);
	spotNode.appendChild(textNode);
	if (this.rank == 1) {
		spotNode.className = "ace";
		tempNode = spotNode.cloneNode(true);
		frontNode.appendChild(tempNode);
	}
	if (this.rank == 3 || this.rank == 5 || this.rank == 9) {
		spotNode.className = "spotB3";
		tempNode = spotNode.cloneNode(true);
		frontNode.appendChild(tempNode);
	}
	if (this.rank == 2 || this.rank == 3) {
		spotNode.className = "spotB1";
		tempNode = spotNode.cloneNode(true);
		frontNode.appendChild(tempNode);
	}
	if (this.rank == 2 || this.rank == 3) {
		spotNode.className = "spotB5";
		tempNode = spotNode.cloneNode(true);
		frontNode.appendChild(tempNode);
	}
	if (this.rank == 4 || this.rank == 5 || this.rank == 6 ||
		this.rank == 7 || this.rank == 8 || this.rank == 9 ||
		this.rank == 10) {
		spotNode.className = "spotA1";
		tempNode = spotNode.cloneNode(true);
		frontNode.appendChild(tempNode);
		spotNode.className = "spotA5";
		tempNode = spotNode.cloneNode(true);
		frontNode.appendChild(tempNode);
		spotNode.className = "spotC1";
		tempNode = spotNode.cloneNode(true);
		frontNode.appendChild(tempNode);
		spotNode.className = "spotC5";
		tempNode = spotNode.cloneNode(true);
		frontNode.appendChild(tempNode);
	}
	if (this.rank == 6 || this.rank == 7 || this.rank == 8) {
		spotNode.className = "spotA3";
		tempNode = spotNode.cloneNode(true);
		frontNode.appendChild(tempNode);
		spotNode.className = "spotC3";
		tempNode = spotNode.cloneNode(true);
		frontNode.appendChild(tempNode);
	}
	if (this.rank == 7 || this.rank == 8 || this.rank == 10) {
		spotNode.className = "spotB2";
		tempNode = spotNode.cloneNode(true);
		frontNode.appendChild(tempNode);
	}
	if (this.rank == 8 || this.rank == 10) {
		spotNode.className = "spotB4";
		tempNode = spotNode.cloneNode(true);
		frontNode.appendChild(tempNode);
	}
	if (this.rank == 9 || this.rank == 10) {
		spotNode.className = "spotA2";
		tempNode = spotNode.cloneNode(true);
		frontNode.appendChild(tempNode);
		spotNode.className = "spotA4";
		tempNode = spotNode.cloneNode(true);
		frontNode.appendChild(tempNode);
		spotNode.className = "spotC2";
		tempNode = spotNode.cloneNode(true);
		frontNode.appendChild(tempNode);
		spotNode.className = "spotC4";
		tempNode = spotNode.cloneNode(true);
		frontNode.appendChild(tempNode);
	}

	// For face cards (Jack, Queen or King), create and add the proper image.
	// For face cards, add suit characters to the upper-left and lower-right
	// corners.

	if (this.rank > 10) {
		tempNode = document.createElement("IMG");
		tempNode.className = "face";
		if (this.rank == 11)
			//tempNode.src = "jack.gif";
			tempNode.src = "data:image/gif;base64,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";
		if (this.rank == 12)
			//tempNode.src = "queen.gif";
			tempNode.src = "data:image/gif;base64,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";
		if (this.rank == 13)
			tempNode.src = "data:image/gif;base64,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";
		tempNode.ondragstart = returnFalse;	// avoid draging the image instead of the card
		frontNode.appendChild(tempNode);
		spotNode.className = "spotA1";
		tempNode = spotNode.cloneNode(true);
		frontNode.appendChild(tempNode);
		spotNode.className = "spotC5";
		tempNode = spotNode.cloneNode(true);
		frontNode.appendChild(tempNode);
	}

	// Add front node to the card node.

	cardNode.appendChild(frontNode);

	// Return the card node.

	return cardNode;
}

// define a static function for that. Better than creating a function for each use
function returnFalse() {return false;}

//=============================================================================
// Stack Object
//	used for desk and for columns
//	columns have elt property, desk has not
//=============================================================================

//-----------------------------------------------------------------------------
// Stack constructor function.
//-----------------------------------------------------------------------------

function Stack() {
	// Create an empty array of cards.
	this.cards = new Array();
}

//-----------------------------------------------------------------------------
// clear: empty Stack
//-----------------------------------------------------------------------------

Stack.prototype.clear = function() {
	var i;
	this.cards = new Array();
	if (this.elt) {
		for (i = this.elt.children.length-1; i >= 0; i--)	// reverse order to remove last first so that indexes don't change
			this.elt.removeChild(this.elt.children[i]);
	}
}

//-----------------------------------------------------------------------------
// makeDeck(n): Initializes a stack using 'n' packs of cards.
//-----------------------------------------------------------------------------

Stack.prototype.makeDeck = function(n) {
	if (bEasyMode) {
		var suits = new Array("H", "S");
		n *= 2;
	} else {
		var suits = new Array("C", "D", "H", "S");
	}
	var i, j, k;
	var m;

	m = 13 * suits.length;

	// Set array of cards.

	this.cards = new Array(n * m);

	// Fill the array with 'n' packs of cards.

	for (i = 0; i < n; i++)
	for (j = 0; j < suits.length; j++)
		for (k = 1; k <= 13; k++)
			this.cards[i * m + j * 13 + (13-k)] = new Card(k, suits[j]);
}

//-----------------------------------------------------------------------------
// stackShuffle(n): Shuffles a stack of cards 'n' times. 
//-----------------------------------------------------------------------------

Stack.prototype.shuffle = function(n) {
	var i, j, k;
	var temp;

	// Shuffle the stack 'n' times.

	for (i = 0; i < n; i++)
		for (j = 0; j < this.cards.length; j++) {
			k = Math.floor(Math.random() * this.cards.length);
			temp = this.cards[j];
			this.cards[j] = this.cards[k];
			this.cards[k] = temp;
		}
}

//-----------------------------------------------------------------------------
// stackDeal(): Removes the first card in the stack and returns it.
//-----------------------------------------------------------------------------

Stack.prototype.deal = function() {
	if (this.cards.length > 0)
		return this.cards.shift();
	else
		return null;
}

//-----------------------------------------------------------------------------
// stackDraw(n): Removes the indicated card from the stack and returns it.
//-----------------------------------------------------------------------------

Stack.prototype.draw = function(n) {
	var oCard;

	if (n >= 0 && n < this.cards.length) {
		oCard = this.cards[n];
		this.cards.splice(n, 1);
	}
	else
		oCard = null;

	return oCard;
}

//-----------------------------------------------------------------------------
// stackAdd(card): Adds the given card to the stack.
//	returns the index of the card in the stack
//-----------------------------------------------------------------------------

Stack.prototype.addCard = function(oCard) {
	var newIndex = this.cards.push(oCard) - 1;
	if (this.elt) oCard.setColumn(this, newIndex);
	return newIndex;
}

//-----------------------------------------------------------------------------
// stackCombine(oOther): Adds the cards in the given stack to the current one.
// The given stack (oOther) is emptied.
//-----------------------------------------------------------------------------

/* not used, should add respace column
Stack.prototype.combine = function(oOther) {
	this.cards = this.cards.concat(oOther.cards);
	oOther.cards = new Array();
}
*/

//-----------------------------------------------------------------------------
// stackCardCount(): Returns the number of cards currently in the stack.
//-----------------------------------------------------------------------------

Stack.prototype.cardCount = function() {
	return this.cards.length;
}

//-----------------------------------------------------------------------------
// mkColumn(): upgrade a Stack object into column by linking to a <div>.
//-----------------------------------------------------------------------------
Stack.prototype.mkColumn = function(n) {
	this.n = n;
	this.elt = document.getElementById('col' + n);
	this.elt.style.left = (leftMargin + n * columnSpacing) + 'px';
	this.elt.stack = this;	// memorize Stack object into the div element
	this.elt.oncontextmenu = returnFalse;
	/*
	if (this.elt.addEventListener) {
		this.elt.addEventListener("click", function(){this.stack.click();}, false);
	} else {
		this.elt.attachEvent('onclick', function(){this.stack.click();});
	}
	*/
}

//-----------------------------------------------------------------------------
// find last card
//-----------------------------------------------------------------------------
Stack.prototype.lastCard = function() {
	if (this.cards.length > 0) return this.cards[this.cards.length - 1];
}

//-----------------------------------------------------------------------------
// find last card and its straight, return a Stack object
// Limit up to the designed card if any
//-----------------------------------------------------------------------------
Stack.prototype.findBottomStraight = function(oBaseCard) {
	if (this.cards.length == 0) return;
	var runningIndex = this.cards.length - 1;
	var runningCard = this.cards[runningIndex];
	if (runningCard == undefined) return;
	var myStack = new Stack();
	myStack.addCard(runningCard);
	var runningSuit = runningCard.suit;
	var runningRank = runningCard.rank;
	for (runningIndex-- ; runningIndex >= 0; runningIndex--) {	// scan column bottom up
		if (runningCard == oBaseCard) break;	// up to the designed card if any
		runningCard = this.cards[runningIndex];
		if (!runningCard.visible) break;	// don't take returned cards
		if (runningCard.suit != runningSuit) break;	// take only card of same suit
		if (runningCard.rank != (runningRank + 1)) break;	// must be the immediate higher card
		myStack.addCard(runningCard);
		runningRank++;
	}
	return myStack;
}

//-----------------------------------------------------------------------------
// handle the click event on column
//-----------------------------------------------------------------------------
Stack.prototype.click = function() {
	var iCol, deltaCol, card, s, higherCard, myMode, oCol;
	//find last card and its straight
	s = this.findBottomStraight();
	if (s == undefined) {
		//this.flash();
		return;
	}
	//console.log('Straight has ' + s.cards.length + ' elements');
	// find a suitable other location and do the move
	higherCard = s.cards[s.cards.length - 1];
	for (myMode = 0; myMode < 3; myMode++) { // first try : same suit, then any suit, then empty columns
		if (myMode == 2 && s.cards.length == 13 && this.cards.length == 13) continue;	// don't move a full suit alone from one column to another
		for (deltaCol = 1; deltaCol < 10; deltaCol++) {	// try each other column begining with the column right from this one
			iCol = this.n + deltaCol;
			if (iCol >= 10) iCol -= 10;
			oCol = cols[iCol];
			if (!oCol.isSuitable(higherCard, myMode)) continue;
			// got a suitable destination, do the move
			this.moveStraight(s, oCol);
			if ((!this.unhideLast()) || (ALLOW_UNDO_HIDE_EASYMODE && bEasyMode)) oUndo.push();
			incMove();
			showDealt();
			oUndo.savePresentSituation(mkStringGame());
			if (checkWin()) return;
			return;
		}
	}
	if (s.cards.length == 13) {	// whole suit done
		this.moveStraight(s);	// remove from the desk
		oFinishedSuits.update();
		if ((!this.unhideLast()) || (ALLOW_UNDO_HIDE_EASYMODE && bEasyMode)) oUndo.push();
		incMove();
		showDealt();
		oUndo.savePresentSituation(mkStringGame());
		return;
	}
	s.flashAll();	// tell player there was no suitable destination
}

//-----------------------------------------------------------------------------
// Move a straight (oStraight) from this column into an other (oCol) or remove (oCol undefined)
//-----------------------------------------------------------------------------
Stack.prototype.moveStraight = function(oStraight, oCol) {
	for (var i = oStraight.cards.length - 1; i >= 0; i--) {
		var myCard = oStraight.cards[i];
		this.cards.pop();
		if (oCol === undefined)
			myCard.remove();
		else
			oCol.addCard(myCard);	// loop with decreasing index so that the order is good here
	}
	if (oCol !== undefined) oCol.respace();
	this.respace();
}

//-----------------------------------------------------------------------------
// Drop a straight (oStraight) here
//-----------------------------------------------------------------------------
Stack.prototype.dropStraight = function(oStraight) {
	for (var i = oStraight.cards.length - 1; i >= 0; i--) {
		var myCard = oStraight.cards[i];
		//console.log('drop ' + myCard.cardToString() + ' to ' + this.elt.id);
		this.addCard(myCard);
	}
	this.respace(true);	// need to force respace because the spacing don't change but cards have moved
}

//-----------------------------------------------------------------------------
// unhide last card
// return true if a card was unhidden (for undo management)
//-----------------------------------------------------------------------------
Stack.prototype.unhideLast = function() {
	var c = this.lastCard();
	if (c == undefined) return;
	if (c.visible) return;
	c.unhide();
	if (!(ALLOW_UNDO_HIDE_EASYMODE && bEasyMode)) oUndo.clear();	// no undo beyond this point
	return true;
}

//-----------------------------------------------------------------------------
// check if a card is suitable to this column
//-----------------------------------------------------------------------------
Stack.prototype.isSuitable = function(newCard, mode) {
//	mode=0 same suit;  mode=1 any suit;  mode=2 empty columns;  mode=99 any mode
		if (this.cards.length == 0) return mode >= 2;	// empty, ok for modes 2 & 99
		if (mode == 2) return false;
		card = this.lastCard();
		if (card == undefined) return false;
		if (mode == 0 && card.suit != newCard.suit) return false;
		if (card.rank != (newCard.rank + 1)) return false;
		return true;
}

//-----------------------------------------------------------------------------
// flash column (indicate move impossible)
//-----------------------------------------------------------------------------
Stack.prototype.flash = function() {
	var c = this.lastCard();
	if (c) c.flash();
}

//-----------------------------------------------------------------------------
// Flash all cards
//-----------------------------------------------------------------------------
Stack.prototype.flashAll = function() {
	var i;
	for (i = 0; i < this.cards.length; i++) {
		this.cards[i].flash();
	}
}

//-----------------------------------------------------------------------------
// Recompute vertical spacing if needed
//-----------------------------------------------------------------------------
Stack.prototype.respace = function(bForce) {
	var nbCard = this.cards.length;
	//console.log('respace, nbCard=' + nbCard);
	if (nbCard <= 1) return;	// nothing to do if 0 or 1 card (no spacing)
	var elt = this.cards[nbCard-1].elt;
	if (elt == undefined) return;
	var parent = elt.parentNode;
	if (parent == undefined) return;
	//console.log('respace, elt=' + elt.innerText.replace(/\n/g, " "));
	var h = window.innerHeight	// height of the viewport
		|| document.documentElement.clientHeight
		|| document.body.clientHeight;
	var rect = parent.getBoundingClientRect();	// rectangle of the column
	var newSpacing = 
		(h - rect.top	// space between top of columns and bottom of viewport
		- 30)	// 30 px margin
		/ (nbCard-1);	// divided by number of spacing
	//console.log('respace, h=' + h + ', rect.top=' + rect.top + ', newSpacing=' + newSpacing);
	if (newSpacing > 40) newSpacing = 40;
	if (bForce || newSpacing != this.spacing) {
		this.spacing = newSpacing;
		// redraw cards
		for (var iPos = 1; iPos < nbCard; iPos++) this.cards[iPos].elt.style.top = (iPos * newSpacing) + 'px';
	}
}

//-----------------------------------------------------------------------------
// Build save string for this column (bCol is true) or for the desk (bCol false or absent)
//-----------------------------------------------------------------------------
Stack.prototype.mkSaveString = function(bCol) {
	var sSave = '';
	var nCards = this.cards.length;
	if (nCards == 0) return bCol ? ' ' : '';	// must put the separator even for empty columns
	var bHidden = true;
	for (var iCard = 0; iCard < nCards; iCard++) {
		var oCard = this.cards[iCard];
		if (bCol && bHidden && oCard.visible) {
			sSave += ' ';	// separator between hidden and visible cards
			bHidden = false;
		}
		sSave += oCard.cardToChar();
	}
	if (bHidden && bCol) sSave += ' ';	// does not happen except for some testing
	return sSave;
}

//=============================================================================
// dragDrop Object
//	used to manage drag'n drop
//	properties
//	oCol : the "from" column
//	xOffset : offset between mouse pointer and left of card when dragging
//	yOffset : offset between mouse pointer and top of card when dragging
//=============================================================================

//-----------------------------------------------------------------------------
// Creation of dragDrop, actually called on a "mouseDown" event
//-----------------------------------------------------------------------------
function DragDrop(ev) {	// arg : event of the mouseDown
	var e, target;
	// store date (to be able to detect "short" clicks
	if (ev.timeStamp) this.tsStart = ev.timeStamp
	else this.tsStart = +new Date();	// "+" convert date object to timestamp
	//find card or Stack to move
	ev = ev || window.event;
	/*
	We are setting target to whatever item the mouse is currently on
	Firefox uses event.target here, MSIE uses event.srcElement
	*/
	target = ev.target || ev.srcElement;
	for (e = target; e != undefined; e = e.parentNode) {
		if (e.oCard == undefined) continue;
		var oCard = e.oCard;
		if (oCard.oCol == undefined) continue;
		this.oCol = oCard.oCol;
		break;
	}
	// find column if any
	if (!this.oCol) return;
	// pbChromeAndroid if (ev.preventDefault) ev.preventDefault();
	var mousePos = mouseCoords(ev);
	this.xOffset = this.oCol.elt.offsetLeft - mousePos.x;
	switch (ev.button) {
		case 2:	// "second" button
			// Straight from oCard to bottom of column, but not including hidden cards
			this.straight = this.oCol.findBottomStraight(oCard);
			break;
		default:
			// find bottom straight
			this.straight = this.oCol.findBottomStraight();
			break;
	}
	if (this.straight == undefined) return;	// happens when a whole straight is removed
	//console.log('new DragDrop, col=' + this.oCol.elt.id + ', Xmouse=' + mousePos.x + ', Ymouse=' + mousePos.y + ', lgStraight=' + this.straight.cards.length + ', offsetLeft of col=' + this.oCol.elt.offsetLeft + ', offsetTop of fistCard=' + this.straight.cards[this.straight.cards.length - 1].elt.offsetTop + ', button=' + ev.button + ', oCard=' + oCard.cardToString());
	this.yOffset = this.straight.cards[this.straight.cards.length - 1].elt.offsetTop + this.oCol.elt.offsetTop - mousePos.y;
	// remove from column
	for (var i = this.straight.cards.length - 1; i >= 0; i--) {
		var myCard = this.straight.cards[i];
		this.oCol.cards.pop();
		if (myCard.elt.parentNode) myCard.elt.parentNode.removeChild(myCard.elt);
		document.body.appendChild(myCard.elt);
	}
	this.moveTo(mousePos);
}

function mouseCoords(ev){
	if(ev.pageX || ev.pageY){
		return {x:ev.pageX, y:ev.pageY};
	}
	return {
		x:ev.clientX + document.body.scrollLeft - document.body.clientLeft,
		y:ev.clientY + document.body.scrollTop - document.body.clientTop
		};
}

// drop the strait
// 3 cases
// on same column : this is a "click", move the strait to whatever other possible column
// on another column and this is possible : move the strait to this column
// on no column or on a an impossible column, put the strait back to the original column
DragDrop.prototype.mouseUp = function(ev) {
	var oMousePos = mouseCoords(ev);
	var nCol = Math.floor((oMousePos.x - leftMargin) / columnSpacing);
	var newCol = cols[nCol];
	//if (this.oCol) console.log('strait from column ' + this.oCol.n + ' dropped on column ' + (newCol ? newCol.n : '<none>'));
	// no column : put it back
	if (!newCol) {
		//console.log('DragDrop.mouseUp, no newCol, back');
		this.moveBackOrig();
	} else if (this.oCol == newCol) {
		var tsNow;
		if (ev.timeStamp) tsNow = ev.timeStamp;
		else tsNow = +new Date();
		//console.log('DragDrop.mouseUp, same column, time(ms)=' + (tsNow - this.tsStart) + ', ev.timeStamp=' + ev.timeStamp + ', new Date=' + (+new Date()) + ', this.tsStart=' + this.tsStart + ', tsNow=' + tsNow);
		if (tsNow < this.tsStart + 300) this.doClick();	// JS timestamp are in millisecond. Test here if less than 0,3 s
		else this.moveBackOrig();
	} else if (this.straight !== undefined) {
		var higherCard = this.straight.cards[this.straight.cards.length - 1];
		if (newCol.isSuitable(higherCard, 99)) {
			newCol.dropStraight(this.straight);
			this.oCol.respace();
			if ((!this.oCol.unhideLast()) || (ALLOW_UNDO_HIDE_EASYMODE && bEasyMode)) oUndo.push();
			incMove();
			showDealt();
			oUndo.savePresentSituation(mkStringGame());
			//console.log('DragDrop.mouseUp, drop here');
		} else {
			//console.log('DragDrop.mouseUp, not suitable');
			this.moveBackOrig();
		}
	}
	if (ev.button == 2 && ev.preventDefault) ev.preventDefault();
	// pbChromeAndroid if (ev.preventDefault) ev.preventDefault();
	ddrop = undefined;
}

DragDrop.prototype.moveBackOrig = function() {
	if (this.straight === undefined) return;
	this.oCol.dropStraight(this.straight);
}

DragDrop.prototype.doClick = function() {
	this.moveBackOrig();
	this.oCol.click();
}

DragDrop.prototype.mouseMove = function(ev) {
	var mousePos = mouseCoords(ev);
	//console.log('DragDrop.MouveMove');
	this.moveTo(mousePos);
}

DragDrop.prototype.moveTo = function(pos) {
	if (this.straight == undefined) return;
	var scrollOffset = document.getElementById('bkground').scrollTop;
	if (scrollOffset == undefined) scrollOffset = 0;
	for (var i = 0; i < this.straight.cards.length; i++) {
		var myCard = this.straight.cards[i];
		//console.log('DragDrop.prototype.moveTo, i=' + i + ', card=' + myCard.cardToString() + ', pos.y=' + pos.y + ', this.yOffset=' + this.yOffset + ', scrollOffset=' + scrollOffset);
		myCard.elt.style.top = (pos.y + 40 * (this.straight.cards.length - (i+1)) + this.yOffset - scrollOffset) + 'px';
		myCard.elt.style.left = (pos.x + this.xOffset) + 'px';
		myCard.elt.style.zIndex = 9999-i;
	}
}

//=============================================================================
// undo Object
// local variables:
//	presentSituation (because it is complex to know if we will save an undo situation before the move, we save always the situation *after* the move here)
//	undoBuffer
//=============================================================================
//-----------------------------------------------------------------------------
// undo : initialize and load from local storage or cookies
//-----------------------------------------------------------------------------
function classUndo() {
	this.undoBuffer = new Array();
	// reload from storage, set color of undo button
	if (useLocalStorage) {
		this.presentSituation = window.localStorage.getItem('ArachnidJSPresent');
		//console.log('classUndo, new, localStorage.length=' + localStorage.length);
		for (var i = 0, len = localStorage.length; i < len; ++i ) {
			if (localStorage.key(i).substr(0, 14) != 'ArachnidJSundo') {
				//console.log('classUndo, new, localStorage, key[' + i + ']=' + localStorage.key(i));
				continue;
			}
			var n = parseInt(localStorage.key(i).substr(14));
			//console.log('classUndo, new, localStorage, key[' + i + ']=' + localStorage.key(i) + ', nUndo=' + n);
			if (!isNaN(n)) this.undoBuffer[n] = window.localStorage.getItem(localStorage.key(i));
		}
	} else {
		// fall back to cookies
		//document.getElementById('log').firstChild.textContent = document.cookie;
		var oUndo = this;	// need a local variable, unable to access [this] in the (forEach) function
		document.cookie.split(";").forEach(function(c) {
			//console.log('classUndo, new, cookies, c=' + c);
			c = c.replace(/^ +/, "");
			if (c.substr(0, 18) == 'ArachnidJSPresent=') {
				oUndo.presentSituation = c.substr(18);
				return;
			}
			if (c.substr(0, 14) != 'ArachnidJSundo') return;
			var m = c.match(/^ArachnidJSundo(\d*)=(.*)$/);
			if (!m) return;
			var n = parseInt(m[1]);
			if (!isNaN(n)) oUndo.undoBuffer[n] = m[2];
			});
	}
	if (this.undoBuffer.length > 0) this.enableButton();
	else                            this.disableButton();
	//this.logDebug('new');
}

//-----------------------------------------------------------------------------
// debug into console
//-----------------------------------------------------------------------------
classUndo.prototype.logDebug = function(sMsg) {
	var s = 'classUndo _____________________, ' + sMsg + ', undoBuffer.length=' + this.undoBuffer.length + ', presentSituation=' + this.presentSituation;
	for (var i = 0; i < this.undoBuffer.length; i++)
		s += "\n\tundoBuffer[" + i + ']=' + this.undoBuffer[i];
	console.log(s);
}

//-----------------------------------------------------------------------------
// undo managing : push previous situation into undo buffer
//-----------------------------------------------------------------------------
classUndo.prototype.push = function() {
	if (!this.presentSituation) return
	//document.getElementById('log').firstChild.textContent = document.cookie;
	var nb = this.undoBuffer.length;
	this.undoBuffer.push(this.presentSituation);
	if (useLocalStorage) {
		window.localStorage.setItem('ArachnidJSundo' +nb, this.presentSituation);
	} else {
		// fall back to cookies
		document.cookie = 'ArachnidJSundo' + nb + '=' + this.presentSituation + ';path=/';
	}
	this.enableButton();
	//this.logDebug('push');
}

//-----------------------------------------------------------------------------
// undo managing : save present situation
//-----------------------------------------------------------------------------
classUndo.prototype.savePresentSituation = function(sSituation) {
	this.presentSituation = sSituation;
	if (useLocalStorage) {
		window.localStorage.setItem('ArachnidJSPresent', sSituation);
	} else {
		// fall back to cookies
		document.cookie = 'ArachnidJSPresent=' + sSituation;
	}
}

//-----------------------------------------------------------------------------
// undo managing : clear undo buffer (when a card has been unhidden)
//-----------------------------------------------------------------------------
classUndo.prototype.clear = function() {
	this.undoBuffer.length = 0;
	if (useLocalStorage) {
		for (var i = localStorage.length-1; i >= 0; i--) {	// always backwards when we remove items
			//console.log('classUndo.clear, localStorage.length=' + localStorage.length + ', i=' + i);
			if (localStorage.key(i).substr(0, 14) != 'ArachnidJSundo') continue;
			localStorage.removeItem(localStorage.key(i));
		}
	} else {
		// fall back to cookies (code derived from https://stackoverflow.com/questions/179355/clearing-all-cookies-with-javascript)
		document.cookie.split(";").forEach(function(c) {
			c = c.replace(/^ +/, "");
			if (c.substr(0, 14) != 'ArachnidJSundo') return;	// don't mess up other cookies
			eraseCookieFromAllPaths(c.replace(/=.*$/, ''));
			});
	}
	this.disableButton();
	//this.logDebug('clear');
	//document.getElementById('log').firstChild.textContent = document.cookie;
}

//-----------------------------------------------------------------------------
// return to previous situation
//-----------------------------------------------------------------------------
classUndo.prototype.undoGame = function() {
	if (this.undoBuffer.length == 0) {
		this.flashButton();
		return;
	}
	var nb = this.undoBuffer.length - 1;
	if (!reloadGame(this.undoBuffer[nb])) {
		this.flashButton();
		return;
	}
	this.undoBuffer.length = nb;	// truncate the array
	if (useLocalStorage) {
		localStorage.removeItem('ArachnidJSundo' + nb);
	} else {
		// fall back to cookies
		eraseCookieFromAllPaths('ArachnidJSundo' + nb); 
	}
	if (nb == 0) this.disableButton();
	showDealt();
	windowResize();	// compress columns as needed
	//console.log('End undoGame, nbUndo=' + nbUndo + ', sName=' + sName);
}

//-----------------------------------------------------------------------------
// gray undo button
//-----------------------------------------------------------------------------
classUndo.prototype.disableButton = function() {
	var elt = document.getElementById('undo');
	elt.className = 'butGrayed';
}

//-----------------------------------------------------------------------------
// Set button to active color undo button
//-----------------------------------------------------------------------------
classUndo.prototype.enableButton = function() {
	var elt = document.getElementById('undo');
	elt.className = 'but';
}

//-----------------------------------------------------------------------------
// Flash undo button
//-----------------------------------------------------------------------------
classUndo.prototype.flashButton = function() {
	var elt = document.getElementById('undo');
	elt.className = 'butFlashed';
	window.setTimeout(function() {elt.className = 'but';}, 100);
	window.setTimeout(function() {elt.className = 'butFlashed';}, 200);
	window.setTimeout(function() {elt.className = 'butGrayed';}, 300);
}

//-----------------------------------------------------------------------------
// Reload game from present buffer. Used only in initA()
//	return true is a game was successfully reloaded
//-----------------------------------------------------------------------------
classUndo.prototype.reloadPresent = function() {
	if (this.presentSituation) return reloadGame(this.presentSituation);
}

//=============================================================================
// classFinishedSuits Object
// local variables:
//	tabFinishedSuits	divs for the finished suits
//	rightSuits			from right of background to right of right completed suit
//	spacingSuits		from right of a suit to right of the following suit
//=============================================================================
//-----------------------------------------------------------------------------
// undo : initialize and load from local storage
//-----------------------------------------------------------------------------
function classFinishedSuits() {
	this.rightSuits = 170;
	this.spacingSuits = 35;
	this.tabFinishedSuits = [];
	for (var j = 0; j < 8; j++) {
		var e = document.getElementById('suit' + j);
		e.style.right = (this.rightSuits + j * this.spacingSuits) + 'px';
		this.tabFinishedSuits.push(e);
	}
}

//-----------------------------------------------------------------------------
// show finished suits
//		+ check coherence : return error string if not OK
//-----------------------------------------------------------------------------
classFinishedSuits.prototype.update = function() {
	var nCards = new Array(0, 0, 0, 0);
	for (var iCol = 0; iCol < 11; iCol++) {
		var oCol;
		if (iCol == 10) oCol = deck;
		else            oCol = cols[iCol];
		for (var iCard = 0, len = oCol.cards.length; iCard < len; iCard++) {
			switch (oCol.cards[iCard].suit) {
				case 'H': nCards[0]++; break;
				case 'S': nCards[1]++; break;
				case 'C': nCards[2]++; break;
				case 'D': nCards[3]++; break;
				default:
					return 'bad suit: ' + oCol.cards[iCard].suit;
			}
		}
	}
	for (var iSuit = 0; iSuit < 4; iSuit++) {
		if (bEasyMode) {
			var tabElt = new Array(this.tabFinishedSuits[iSuit * 4],
								this.tabFinishedSuits[iSuit * 4 + 1],
								this.tabFinishedSuits[iSuit * 4 + 2],
								this.tabFinishedSuits[iSuit * 4 + 3]);
			var sColor = iSuit ? 'black' : 'red';
			var maxAllowed = iSuit > 1 ? 0 : 52;
		} else {
			var tabElt = new Array(this.tabFinishedSuits[iSuit * 2],
								this.tabFinishedSuits[iSuit * 2 + 1]);
			var sColor = (iSuit == 1 || iSuit == 2) ? 'black' : 'red';
			var maxAllowed = 26;
		}
		if (nCards[iSuit] > maxAllowed) return 'nCards=' + nCards[iSuit] + ' for Suit ' + 'HSCD'.substr(iSuit, 1);
		// must have a full number of suits
		if ((nCards[iSuit] % 13) != 0) return 'nCards=' + nCards[iSuit] + ' for Suit ' + 'HSCD'.substr(iSuit, 1);
		if (maxAllowed == 0) continue;
		// show finished Suits
		var nNotFinishedSuits = nCards[iSuit] / 13;
		for (var i = 0, l = tabElt.length; i < l; i++) {
			tabElt[i].style.color = i < nNotFinishedSuits ? 'transparent' : sColor;
			tabElt[i].firstChild.textContent = '♥♠♣♦'.substr(iSuit, 1);
		}
	}
}

//=============================================================================
// End of objects
//=============================================================================

//-----------------------------------------------------------------------------
// global variables
//-----------------------------------------------------------------------------
var deck;	// cards remaining to be dealt
var cols;	// 10 columns
var ddrop;	// dragDrop object, undefined when there is no active drag'n drop
var oFinishedSuits;			// manage where to show finished suits
var timestampStart;			// used to display elapsed time
var idTimerElapsed;			// used to display elapsed time
var nbMove;					// used to display number of moves for this game
var oUndo;					// undo object
var useLocalStorage;		// because Edge, need to store if localStorage is available or not
var useFileReader;			// able to restore from file or not
var bEasyMode;				// use 4 times Hearth & Spades instead of 2 times each suit

//-----------------------------------------------------------------------------
// global constants
//-----------------------------------------------------------------------------
var leftMargin = 10;		// from left of background to left of first column
var columnSpacing = 102;	// from left of a column to left of next column

//-----------------------------------------------------------------------------
// Build a string containing the current situation
//-----------------------------------------------------------------------------
function mkStringGame() {
	// format
	// each card is coded with a letter A, ..., Z, a, b, ... z (order ace to king, club to spade)
	// break (change form one type to the next) is space
	// column1, hidden cards
	// column1, showed cards
	// column2, 3,... 10
	// deck
	// number of moves (a number) with a '+' if easyMode
	// timestamp of game start (a number)
	var sSave = '';
	// Columns
	for (var iCol = 0; iCol < 10; iCol++) {
		sSave += cols[iCol].mkSaveString(true) + ' ';
	}
	// deck, nb move, timestamp start
	sSave += deck.mkSaveString(false) + (bEasyMode ? ' +' : ' ') + nbMove + ' ' + timestampStart;
	//console.log('mkStringGame ' + sSave);
	return sSave;
}

//-----------------------------------------------------------------------------
// http://stackoverflow.com/questions/400212/how-do-i-copy-to-the-clipboard-in-javascript
//-----------------------------------------------------------------------------
function copyTextToClipboard(text) {
	var textArea = document.createElement("textarea");
	//
	// *** This styling is an extra step which is likely not required. ***
	//
	// Why is it here? To ensure:
	// 1. the element is able to have focus and selection.
	// 2. if element was to flash render it has minimal visual impact.
	// 3. less flakyness with selection and copying which **might** occur if
	//    the textarea element is not visible.
	//
	// The likelihood is the element won't even render, not even a flash,
	// so some of these are just precautions. However in IE the element
	// is visible whilst the popup box asking the user for permission for
	// the web page to copy to the clipboard.
	//

	// Place in top-left corner of screen regardless of scroll position.
	textArea.style.position = 'fixed';
	textArea.style.top = 0;
	textArea.style.left = 0;

	// Ensure it has a small width and height. Setting to 1px / 1em
	// doesn't work as this gives a negative w/h on some browsers.
	textArea.style.width = '2em';
	textArea.style.height = '2em';

	// We don't need padding, reducing the size if it does flash render.
	textArea.style.padding = 0;

	// Clean up any borders.
	textArea.style.border = 'none';
	textArea.style.outline = 'none';
	textArea.style.boxShadow = 'none';

	// Avoid flash of white box if rendered for any reason.
	textArea.style.background = 'transparent';

	textArea.value = text;

	document.body.appendChild(textArea);

	textArea.select();

	var successful = document.execCommand('copy');

	document.body.removeChild(textArea);
	return successful;
}

//-----------------------------------------------------------------------------
// https://stackoverflow.com/questions/14733374/how-to-generate-md5-file-hash-on-javascript
//-----------------------------------------------------------------------------
var MD5 = function(s){function L(k,d){return(k<<d)|(k>>>(32-d))}function K(G,k){var I,d,F,H,x;F=(G&2147483648);H=(k&2147483648);I=(G&1073741824);d=(k&1073741824);x=(G&1073741823)+(k&1073741823);if(I&d){return(x^2147483648^F^H)}if(I|d){if(x&1073741824){return(x^3221225472^F^H)}else{return(x^1073741824^F^H)}}else{return(x^F^H)}}function r(d,F,k){return(d&F)|((~d)&k)}function q(d,F,k){return(d&k)|(F&(~k))}function p(d,F,k){return(d^F^k)}function n(d,F,k){return(F^(d|(~k)))}function u(G,F,aa,Z,k,H,I){G=K(G,K(K(r(F,aa,Z),k),I));return K(L(G,H),F)}function f(G,F,aa,Z,k,H,I){G=K(G,K(K(q(F,aa,Z),k),I));return K(L(G,H),F)}function D(G,F,aa,Z,k,H,I){G=K(G,K(K(p(F,aa,Z),k),I));return K(L(G,H),F)}function t(G,F,aa,Z,k,H,I){G=K(G,K(K(n(F,aa,Z),k),I));return K(L(G,H),F)}function e(G){var Z;var F=G.length;var x=F+8;var k=(x-(x%64))/64;var I=(k+1)*16;var aa=Array(I-1);var d=0;var H=0;while(H<F){Z=(H-(H%4))/4;d=(H%4)*8;aa[Z]=(aa[Z]| (G.charCodeAt(H)<<d));H++}Z=(H-(H%4))/4;d=(H%4)*8;aa[Z]=aa[Z]|(128<<d);aa[I-2]=F<<3;aa[I-1]=F>>>29;return aa}function B(x){var k="",F="",G,d;for(d=0;d<=3;d++){G=(x>>>(d*8))&255;F="0"+G.toString(16);k=k+F.substr(F.length-2,2)}return k}function J(k){k=k.replace(/rn/g,"n");var d="";for(var F=0;F<k.length;F++){var x=k.charCodeAt(F);if(x<128){d+=String.fromCharCode(x)}else{if((x>127)&&(x<2048)){d+=String.fromCharCode((x>>6)|192);d+=String.fromCharCode((x&63)|128)}else{d+=String.fromCharCode((x>>12)|224);d+=String.fromCharCode(((x>>6)&63)|128);d+=String.fromCharCode((x&63)|128)}}}return d}var C=Array();var P,h,E,v,g,Y,X,W,V;var S=7,Q=12,N=17,M=22;var A=5,z=9,y=14,w=20;var o=4,m=11,l=16,j=23;var U=6,T=10,R=15,O=21;s=J(s);C=e(s);Y=1732584193;X=4023233417;W=2562383102;V=271733878;for(P=0;P<C.length;P+=16){h=Y;E=X;v=W;g=V;Y=u(Y,X,W,V,C[P+0],S,3614090360);V=u(V,Y,X,W,C[P+1],Q,3905402710);W=u(W,V,Y,X,C[P+2],N,606105819);X=u(X,W,V,Y,C[P+3],M,3250441966);Y=u(Y,X,W,V,C[P+4],S,4118548399);V=u(V,Y,X,W,C[P+5],Q,1200080426);W=u(W,V,Y,X,C[P+6],N,2821735955);X=u(X,W,V,Y,C[P+7],M,4249261313);Y=u(Y,X,W,V,C[P+8],S,1770035416);V=u(V,Y,X,W,C[P+9],Q,2336552879);W=u(W,V,Y,X,C[P+10],N,4294925233);X=u(X,W,V,Y,C[P+11],M,2304563134);Y=u(Y,X,W,V,C[P+12],S,1804603682);V=u(V,Y,X,W,C[P+13],Q,4254626195);W=u(W,V,Y,X,C[P+14],N,2792965006);X=u(X,W,V,Y,C[P+15],M,1236535329);Y=f(Y,X,W,V,C[P+1],A,4129170786);V=f(V,Y,X,W,C[P+6],z,3225465664);W=f(W,V,Y,X,C[P+11],y,643717713);X=f(X,W,V,Y,C[P+0],w,3921069994);Y=f(Y,X,W,V,C[P+5],A,3593408605);V=f(V,Y,X,W,C[P+10],z,38016083);W=f(W,V,Y,X,C[P+15],y,3634488961);X=f(X,W,V,Y,C[P+4],w,3889429448);Y=f(Y,X,W,V,C[P+9],A,568446438);V=f(V,Y,X,W,C[P+14],z,3275163606);W=f(W,V,Y,X,C[P+3],y,4107603335);X=f(X,W,V,Y,C[P+8],w,1163531501);Y=f(Y,X,W,V,C[P+13],A,2850285829);V=f(V,Y,X,W,C[P+2],z,4243563512);W=f(W,V,Y,X,C[P+7],y,1735328473);X=f(X,W,V,Y,C[P+12],w,2368359562);Y=D(Y,X,W,V,C[P+5],o,4294588738);V=D(V,Y,X,W,C[P+8],m,2272392833);W=D(W,V,Y,X,C[P+11],l,1839030562);X=D(X,W,V,Y,C[P+14],j,4259657740);Y=D(Y,X,W,V,C[P+1],o,2763975236);V=D(V,Y,X,W,C[P+4],m,1272893353);W=D(W,V,Y,X,C[P+7],l,4139469664);X=D(X,W,V,Y,C[P+10],j,3200236656);Y=D(Y,X,W,V,C[P+13],o,681279174);V=D(V,Y,X,W,C[P+0],m,3936430074);W=D(W,V,Y,X,C[P+3],l,3572445317);X=D(X,W,V,Y,C[P+6],j,76029189);Y=D(Y,X,W,V,C[P+9],o,3654602809);V=D(V,Y,X,W,C[P+12],m,3873151461);W=D(W,V,Y,X,C[P+15],l,530742520);X=D(X,W,V,Y,C[P+2],j,3299628645);Y=t(Y,X,W,V,C[P+0],U,4096336452);V=t(V,Y,X,W,C[P+7],T,1126891415);W=t(W,V,Y,X,C[P+14],R,2878612391);X=t(X,W,V,Y,C[P+5],O,4237533241);Y=t(Y,X,W,V,C[P+12],U,1700485571);V=t(V,Y,X,W,C[P+3],T,2399980690);W=t(W,V,Y,X,C[P+10],R,4293915773);X=t(X,W,V,Y,C[P+1],O,2240044497);Y=t(Y,X,W,V,C[P+8],U,1873313359);V=t(V,Y,X,W,C[P+15],T,4264355552);W=t(W,V,Y,X,C[P+6],R,2734768916);X=t(X,W,V,Y,C[P+13],O,1309151649);Y=t(Y,X,W,V,C[P+4],U,4149444226);V=t(V,Y,X,W,C[P+11],T,3174756917);W=t(W,V,Y,X,C[P+2],R,718787259);X=t(X,W,V,Y,C[P+9],O,3951481745);Y=K(Y,h);X=K(X,E);W=K(W,v);V=K(V,g)}var i=B(Y)+B(X)+B(W)+B(V);return i.toLowerCase()};

//-----------------------------------------------------------------------------
// build a table of cards from the string in the undo buffer
// return nothing if error
//-----------------------------------------------------------------------------
function buildCardArray(s) {
	var tabRet = new Array;
	var visible = false;	// hidden cards coming first
	//console.log('buildCardArray ' + s);
	for (var i = 0; i < s.length; i++) {
		var v = s.charCodeAt(i);
		if (v >= 65 && v <= 77) {	// clubs ace will be 'A', king will be 'M'
			var c = new Card(v-64, 'C');
		} else if (v >= 78 && v <= 90) {	// diamonds ace will be 'N', king will be 'Z'
			c = new Card(v-77, 'D');
		} else if (v >= 97 && v <= 109) {	// hearts ace will be 'a', king will be 'm'
			c = new Card(v-96, 'H');
		} else if (v >= 110 && v <= 122) {	// spades ace will be 'n', king will be 'z'
			c = new Card(v-109, 'S');
		} else if (v == 32) {	// space is separator between hidden and visible
			visible = true;
			continue;
		} else {
			return;	// error
		}
		if (visible) c.visible = true;
		tabRet.push(c);
		//console.log('push ' + c.cardToDebug());
	}
	return tabRet;
}

//-----------------------------------------------------------------------------
// Log game situation into console
//-----------------------------------------------------------------------------
function logDebugGame(sMsg) {
	var s = '';
	for (var iCol = 0; iCol < 10; iCol++) {
		var nHidden = 0; nVisible = 0, inVisible = false, oCol = cols[iCol];
		for (var iCard = 0; iCard < oCol.cards.length; iCard++) {
			var oCard = oCol.cards[iCard];
			if (oCard.visible) {
				inVisible = true;
				nVisible++;
			} else {
				if (inVisible) console.log('******** error, column ' + iCol + ', card ' + oCard.cardToString() + ' hidden after visible card');
				nHidden++;
			}
		}
		s += '(' + nHidden + ' ' + nVisible +') ';
	}
	//console.log('Game ' + sMsg + ' ' + s + ' deck=' + deck.cards.length);
}

//-----------------------------------------------------------------------------
// Reload game from undo buffer (return false if error)
//-----------------------------------------------------------------------------
function reloadGame(sSave) {
	//console.log('reloadGame ' + sSave);
	tabSave = sSave.split(' ');
	// columns
	for (var iCol = 0; iCol < 10; iCol++) {
		oCol = cols[iCol];
		var Cards = buildCardArray(tabSave[iCol * 2] + ' ' + tabSave[iCol * 2 + 1]);
		if (Cards === undefined) return;	// error
		for (var iCard = 0; iCard < Cards.length; iCard++) {
			// avoid the painful (for the navigator) process of removing the card element if possible
			if (iCard >= oCol.cards.length) break;
			if (!oCol.cards[iCard].match(Cards[iCard])) {
				//console.log('reloadGame, iCol=' + iCol + ', iCard=' + iCard + ', col ' + oCol.cards[iCard].cardToDebug() + ', undo ' + Cards[iCard].cardToDebug());
				break;
			}
		}
		// remove remaining cards on the desk (and delete HTML elements)
		for (var iCard2 = oCol.cards.length - 1; iCard2 >= iCard; iCard2--) oCol.cards[iCard2].remove();
		oCol.cards.length = iCard;	// truncate the array
		// add additional cards
		for (iCard2 = iCard; iCard2 < Cards.length; iCard2++) {
			var i = oCol.addCard(Cards[iCard2]);
			if (Cards[iCard2].visible) oCol.cards[i].unhide();
		}
	}
	// deck
	deck.cards =  buildCardArray(tabSave[20]);
	//console.log('reloadGame, tabSave ' + tabSave[20] + '---' + tabSave[21] + '---' + tabSave[22]);
	// number of moves & easyMode
	bEasyMode = tabSave[21].substr(0, 1) == '+';
	document.getElementById('easyChk').checked = bEasyMode;
	nbMove = Math.round(tabSave[21]);
	showMoves();
	// timestamp of game start
	timestampStart = Math.round(tabSave[22]);
	showElapsed();
	// update finished suits & check coherence
	var sError = oFinishedSuits.update();
	if (sError) {
		console.log('**************reloadGame, internal error, ' + sError);
		return;
	}
	// need to save Present
	oUndo.savePresentSituation(mkStringGame());
	return true;
}

//-----------------------------------------------------------------------------
// Restore button was pressed
//-----------------------------------------------------------------------------
function restoreButton() {
	alert('Drag and drop the file into the game');
	return;
	/*
	if (window.clipboardData && window.clipboardData.getData) {
		var sRestore = window.clipboardData.getData('Text');
		if (sRestore.substr(0, 11) != 'ArachnidJS ') {
			alert('Copy the saved game into the clipboard');
			return;
		}
		if (!reloadGame(sRestore.substr(11))) {
			alert('unable to reload game');
			return;
		}
		return;
	}
	alert('Browser not compliant');
	*/
}

//-----------------------------------------------------------------------------
// Check validity of saved game, return the saveGame string
//-----------------------------------------------------------------------------
function checkGame(sGame) {
	var t = sGame.split(/ /);
	if (t.length != 25) return;
	if (t[0] != 'ArachnidJS') return;
	sMD5 = t[24];
	t = t.slice(1, 24);
	var s = t.join(' ');
	// check MD5
	if (MD5(s + ' ') != sMD5) return;
	return s;
}

//-----------------------------------------------------------------------------
// Reload from a string the user may have cheated
//-----------------------------------------------------------------------------
function restoreGame(sGame) {
	var s = checkGame(sGame);
	if (!s) {
		alert('This is not a valid Arachnid game');
		return;
	}
	// actual reloading
	oUndo.push();
	if (reloadGame(s)) return;	// return ik OK
	oUndo.undoGame();
	alert('Unable to restore this game');
}

//-----------------------------------------------------------------------------
// Save data into a file on disk
// https://stackoverflow.com/questions/13405129/javascript-create-and-save-file
//-----------------------------------------------------------------------------
function download(data, filename, type) {
	var file = new Blob([data], {type: type});
	if (window.navigator.msSaveOrOpenBlob) // IE10+
		window.navigator.msSaveOrOpenBlob(file, filename);
	else { // Others
		var a = document.createElement("a"),
				url = URL.createObjectURL(file);
		a.href = url;
		a.download = filename;
		document.body.appendChild(a);
		a.click();
		setTimeout(function() {
			document.body.removeChild(a);
			window.URL.revokeObjectURL(url);  
		}, 0); 
	}
}

//-----------------------------------------------------------------------------
// Pad a number to 2 chars
//-----------------------------------------------------------------------------
function pad(n) {return n<10 ? '0'+n : n}

//-----------------------------------------------------------------------------
// Put the present situation into a file or into the clipboard
//	Works only in reaction to a user click
//-----------------------------------------------------------------------------
function saveGame() {
	var sSave = mkStringGame();
	sSave = 'ArachnidJS ' + sSave + ' ' + MD5(sSave + ' ');	// always add salt when doing MD5 cooking
	try {
		// "file download" version
		var dNow = new Date();
		var sNow = dNow.getFullYear() + '' + pad(dNow.getMonth() + 1) + '' + pad(dNow.getDate()) + '-' +
			  pad(dNow.getHours()) + '' + pad(dNow.getMinutes()) + '' + pad(dNow.getSeconds());
		download(sSave, 'ArachnidJS-' + sNow + '.txt', 'txt');
		return;
	} catch (e) {
	}
//	fall back to "clipboard" version
	var bSuccess = copyTextToClipboard(sSave);
	if (bSuccess) alert('Game has been copied into your Clipboard\nPaste it into a new text file (you can use notepad)');
	else          alert('Failed to generate saved game');
}

//-----------------------------------------------------------------------------
// Check if the 8 suits are whole and on the desk. Show Win message if yes (and return true)
//-----------------------------------------------------------------------------
function checkWin() {
	var stackedWholeSuit = 0;
	var nWholeSuit = 0;
	for (var iCol = 0; iCol < 10; iCol++) {
		var oCol = cols[iCol];
		// If column is empty, skip
		if (oCol.cards[0] == undefined) continue;
		// if first card is hidden => not (yet) won
		//console.log('checkWin, iCol=' + iCol + ', fisrt card visible=' + oCol.cards[0].visible + ', length=' + oCol.cards.length);
		if (oCol.cards[0].visible !== true) return;
		// check for whole suits
		for (var iSuit = 0; ; iSuit++) {
			if (((iSuit + 1) * 13) > oCol.cards.length) return;
			var suit = oCol.cards[iSuit * 13].suit;
			for (var iRank = 1; iRank <= 13; iRank++) {
				var oCard = oCol.cards[iSuit * 13 + iRank - 1];
				//console.log('checkWin, iSuit=' + iSuit + ', iRank=' + iRank + ', card=' + oCard.cardToString());
				if (oCard.suit != suit) return;	// not same suit than the first of the 13 cards straight
				if (oCard.rank != (14-iRank)) return;	// not the good rank
			}
			nWholeSuit++;
			if (iSuit > 0) stackedWholeSuit++;
			if (((iSuit + 1) * 13) == oCol.cards.length) break; // done with this column. It is OK
		}
	}
	if (nWholeSuit < 8)
		win();
	else
		win(stackedWholeSuit);
	return true;
}

//-----------------------------------------------------------------------------
// Win ! (feel free to be creative, here ;)
// Arg
//	absent : standard (all cards removed from the desk)
//	present : all suits whole and present on the desk
//				the number is the number of stacked suits (1 to 7)
//-----------------------------------------------------------------------------
function win(level) {
	var e = document.getElementById("win");
	e.style.display = "block";
	switch (level) {
		case undefined:
			e.firstChild.textContent  = "You win!";
			break;
		case 0:
			e.firstChild.textContent  = "You did it in the elegant way!";
			break;
		case 1:
			e.firstChild.textContent  = "One stack: this is a great achievment!";
			break;
		case 2:
			e.firstChild.textContent  = "Two stacks: rarely seen!";
			break;
		default:
			e.firstChild.textContent  = level + " stacks: never seen, consider applying to the Guiness book!";
			break;
	}
	killTimerElapsed();
}

//-----------------------------------------------------------------------------
// initialization (body.onload)
//-----------------------------------------------------------------------------
function initA() {
	var iCol, n, iCard, oCard, iCol, j, k;
	// build deck
	deck = new Stack();
	// create columns
	cols = new Array;
	for (iCol = 0; iCol < 10; iCol++) {
		cols[iCol] = new Stack(iCol);
		cols[iCol].mkColumn(iCol);
	}
	// prepare where the completed suits go
	oFinishedSuits = new classFinishedSuits();
	// prepare drag'n drop
	document.onmousemove = mouseMove;
	document.onmousedown = mouseDown;
	document.onmouseup   = mouseUp;
	document.addEventListener("touchstart", touchHandler, true);
	document.addEventListener("touchmove", touchHandler, true);
	document.addEventListener("touchend", touchHandler, true);
	document.addEventListener("touchcancel", touchHandler, true);
	// viewport resize
	window.onresize = windowResize;
	window.orientationChange = windowResize;
	// debug right click
	//document.body.oncontextmenu = function(ev) {ev = ev || window.event; target = ev.target || ev.srcElement; console.log('debugRightClick ev.target' + ev.target.id);};
	// use LocalStorage or not
	try {	// the following line throws an exception with Edge on a local file
		if (window.localStorage) useLocalStorage = true;
	} catch (e) {
	}
	// able to restore (from file) or not
	try {	// the following line throws an exception with Edge on a local file
		var xx = new FileReader();
		useFileReader = true;
	} catch (e) {
	}
	if (useFileReader) {	// prepare drag'n drop file
		var dropZone = document.getElementById('bkground');
		dropZone.addEventListener('dragover', handleDragOver, false);
		dropZone.addEventListener('drop', handleFileSelect, false);
	}
	// initialize undo mechanism
	oUndo = new classUndo();
	// reload current (before browser was halted or before F5) or initialize new game
	if (oUndo.reloadPresent()) {
		idTimerElapsed = setInterval(showElapsed, 1000);
		showDealt();
		logDebugGame('initA');
	} else {
		newGame();
	}
	// col compression if needed
	windowResize();
}

//-----------------------------------------------------------------------------
// Handle "drop" event when restoring a game
//-----------------------------------------------------------------------------
function handleFileSelect(evt) {
	evt.stopPropagation();
	evt.preventDefault();

	var files = evt.dataTransfer.files; // FileList object.

	if (files && files[0]) {
		var reader = new FileReader();
		reader.onload = function() {
			console.log('filename=' + files[0].name + ', sGame=' + reader.result);
			restoreGame(reader.result);
		}
		reader.readAsText(files[0]);
	}
}

//-----------------------------------------------------------------------------
// Handle "drag" event when restoring a game
//-----------------------------------------------------------------------------
function handleDragOver(evt) {
	evt.stopPropagation();
	evt.preventDefault();
	evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
}

//-----------------------------------------------------------------------------
// Simulate mouse on smartphone/tablet
// we simulate a *right* click to be able to split same suit straights
// https://stackoverflow.com/questions/1517924/javascript-mapping-touch-events-to-mouse-events
//-----------------------------------------------------------------------------
function touchHandler(event)
{
	var touches = event.changedTouches,
		first = touches[0],
		type = "";
	//logScreen('Enter touchHandler ' + event.type + ' y=' + first.clientY);
	switch(event.type)
	{
		case "touchstart": type = "mousedown"; break;
		case "touchmove":  type = "mousemove"; break;
		case "touchend":   type = "mouseup";   break;
		default:
			//logScreen('Exit touchHandler, ignored');
			return;
	}

	// initMouseEvent(type, canBubble, cancelable, view, clickCount, 
	//                screenX, screenY, clientX, clientY, ctrlKey, 
	//                altKey, shiftKey, metaKey, button, relatedTarget);

	var simulatedEvent = document.createEvent("MouseEvent");
	simulatedEvent.initMouseEvent(type, true, true, window, 1, 
								  first.screenX, first.screenY, 
								  first.clientX, first.clientY, false, 
								  false, false, false, 2/*right*/, null);

	first.target.dispatchEvent(simulatedEvent);
	if (event.type == 'touchmove') {
		event.preventDefault();
	} else if (first.clientY < 50) {
		// don't prevent default, need the touch to be converted to a "click"
	} else {
		var eHelp = document.getElementById('help-all');
		if (eHelp.style.display == 'block') {
			// don't prevent default, need the touch to be converted to a "click"
		} else if (!ddrop) {
			event.preventDefault();	// avoid getting the "click" twice
		}
	}
	//logScreen('Exit touchHandler');
	}

//-----------------------------------------------------------------------------
// deal a row
//-----------------------------------------------------------------------------
function dealRow() {
	var iCol, oCard, bBlocked;
	// no deal if there is at least one empty column
	for (iCol = 0; iCol < 10; iCol++) {
		if (cols[iCol].cards.length == 0) bBlocked = true;
	}
	// no deal if there are no more cards to deal
	if (deck.cards.length == 0)  bBlocked = true;
	if (bBlocked) {
		// flash deal button
		var elt = document.getElementById('deal');
		elt.className = 'butFlashed';
		window.setTimeout(function() {elt.className = 'but';}, 100);
		window.setTimeout(function() {elt.className = 'butFlashed';}, 200);
		window.setTimeout(function() {elt.className = 'butGrayed';}, 300);
		return;
	}
	for (iCol = 0; iCol < 10; iCol++) {
		oCard = deck.deal();	// get next dealed card
		cols[iCol].addCard(oCard);
		oCard.unhide();
		cols[iCol].respace();
	}
	showDealt();
	oUndo.clear();	// block undo because some cards where unhidden 
	oUndo.savePresentSituation(mkStringGame());
}

//-----------------------------------------------------------------------------
// gray undo button
//-----------------------------------------------------------------------------
function disableDealtButton(hasEmptyCol) {
	var elt = document.getElementById('deal');
	elt.className = 'butGrayed';
	if (hasEmptyCol) elt.title = 'Cannot deal when there is an empty column';
	else             elt.removeAttribute('title');
}

//-----------------------------------------------------------------------------
// Set button to active color undo button
//-----------------------------------------------------------------------------
function enableDealtButton() {
	var elt = document.getElementById('deal');
	elt.className = 'but';
	elt.removeAttribute('title');
}

//-----------------------------------------------------------------------------
// display the count of already dealt + gray/ungray the button
//-----------------------------------------------------------------------------
function showDealt() {
	var nLeft = deck.cardCount()/10;
	var hasEmptyCol = false;
	for (var iCol = 0; iCol < 10; iCol++) {
		if (cols[iCol].cards.length == 0) {hasEmptyCol = true; break;}
	}
	document.getElementById('dealt').innerHTML = (5-nLeft) + '/5';
	if (hasEmptyCol || nLeft <= 0) disableDealtButton(hasEmptyCol);
	else          enableDealtButton();
}

//-----------------------------------------------------------------------------
// new game
//-----------------------------------------------------------------------------
function normalGame() {
	deck.shuffle(5);
	for (var iCol = 0; iCol < 10; iCol++) {
		// empty
		cols[iCol].clear();
		// fill with 5 or 6 cards
		var n = ((iCol % 3)==0) ? 6 : 5;
		for (var iCard = 0; iCard < n; iCard++) {
			var oCard = deck.deal();	// get next dealed card
			cols[iCol].addCard(oCard);
		}
		cols[iCol].cards[n-1].unhide();
		cols[iCol].respace();
	}
}

//-----------------------------------------------------------------------------
// configuration for testing end of game (win)
//-----------------------------------------------------------------------------
function testConfig1() {
	// fill 8 cols
	for (var iCol = 0; iCol < 8; iCol++) {
		// fill with 13 cards
		for (var iCard = 0; iCard < 13; iCard++) {
			var oCard = deck.deal();	// get next dealed card
			 cols[iCol].addCard(oCard);
			oCard.unhide();
		}
		cols[iCol].respace();
	}
	// move one card out of its suit
	var myCard = cols[0].cards[12];
	cols[0].cards.pop();
	cols[8].addCard(myCard);
}

//-----------------------------------------------------------------------------
// configuration for testing full suit above other cards
//-----------------------------------------------------------------------------
function testConfig2(bHide) {
	// fill 5 cols
	for (var iCol = 0; iCol < 5; iCol++) {
		// fill with 13 cards
		for (var iCard = 0; iCard < 13; iCard++) {
			var oCard = deck.deal();	// get next dealed card
			cols[iCol].addCard(oCard);
			if (!bHide) oCard.unhide();
		}
		cols[iCol].respace();
	}
	// move three cards out of their suit
	for (var i = 0; i < 3; i++) {
		var myCard = cols[0].cards[12-i];
		cols[0].cards.pop();
		cols[7+i].addCard(myCard);
		}
	// stack next 2 suits
	for (var iCol = 1; iCol <=2; iCol++) {
		// fill with 13 cards
		for (var iCard = 0; iCard < 13; iCard++) {
			var oCard = deck.deal();	// get next dealed card
			cols[iCol].addCard(oCard);
			oCard.unhide();
		}
		cols[iCol].respace();
	}
	// fill last suit on top of one alone card
	for (var iCard = 0; iCard < 13; iCard++) {
		var oCard = deck.deal();	// get next dealed card
		cols[8].addCard(oCard);
		oCard.unhide();
	}
	cols[8].respace();
}

//-----------------------------------------------------------------------------
// call each time a move is done
//-----------------------------------------------------------------------------
function incMove() {
	nbMove++;
	showMoves();
}

//-----------------------------------------------------------------------------
// display number of moves for this game
//-----------------------------------------------------------------------------
function showMoves() {
	document.getElementById('moves').firstChild.textContent = nbMove + ' move' + (nbMove > 1 ? 's' : '');
}

//-----------------------------------------------------------------------------
// clear cookie (doing it for each path was necessary in IE11, local file)
// https://stackoverflow.com/questions/179355/clearing-all-cookies-with-javascript
//-----------------------------------------------------------------------------
function eraseCookieFromAllPaths(name) {
	var pathBits = location.pathname.split('/');
	var pathCurrent = ' path=';

	// do a simple pathless delete first.
	document.cookie = name + '=; expires=Thu, 01-Jan-1970 00:00:01 GMT;';

	for (var i = 0; i < pathBits.length; i++) {
		pathCurrent += ((pathCurrent.substr(-1) != '/') ? '/' : '') + pathBits[i];
		document.cookie = name + '=; expires=Thu, 01-Jan-1970 00:00:01 GMT;' + pathCurrent + ';';
	}
}

//-----------------------------------------------------------------------------
// Convert a timestamp into hh:mm:ss
//-----------------------------------------------------------------------------
Number.prototype.toHHMMSS = function () {
	var sec_num = Math.round(this / 1000);
	var hours   = Math.floor(sec_num / 3600);
	var minutes = Math.floor((sec_num - (hours * 3600)) / 60);
	var seconds = sec_num - (hours * 3600) - (minutes * 60);

	if (hours   < 10) {hours   = "0"+hours;}
	if (minutes < 10) {minutes = "0"+minutes;}
	if (seconds < 10) {seconds = "0"+seconds;}
	return hours+':'+minutes+':'+seconds;
}

//-----------------------------------------------------------------------------
// display elapsed time for this game
// called every second (timer)
//-----------------------------------------------------------------------------
function showElapsed() {
	var tsNow = +new Date();	// "+" convert date object to timestamp
	document.getElementById('elapsed').firstChild.textContent = (tsNow - timestampStart).toHHMMSS();
}

//-----------------------------------------------------------------------------
// kill timer for elapsed time
//-----------------------------------------------------------------------------
function killTimerElapsed() {
	if (idTimerElapsed == undefined) return;
	clearInterval(idTimerElapsed);
	idTimerElapsed = undefined;
}

//-----------------------------------------------------------------------------
// new game
//-----------------------------------------------------------------------------
function newGame() {
	bEasyMode = document.getElementById('easyChk').checked;
	deck.makeDeck(2);
	// empty deck
	for (var iCol = 0; iCol < 10; iCol++) cols[iCol].clear();

	normalGame();
	//testConfig1();
	//testConfig2(false);

	showDealt();
	var sError = oFinishedSuits.update();
	if (sError) console.log('**************newGame, internal error, ' + sError);
	document.getElementById("win").style.display = 'none';
	timestampStart = +new Date();	// "+" convert date object to timestamp
	showElapsed();
	if (!idTimerElapsed) idTimerElapsed = setInterval(showElapsed, 1000);
	nbMove = 0;
	showMoves();
	oUndo.push();	// allow to undo across newGame
	oUndo.savePresentSituation(mkStringGame());
	enableDealtButton();
}

//-----------------------------------------------------------------------------
// Viewport resize event handler
//-----------------------------------------------------------------------------
function windowResize(ev){
	for (var iCol = 0; iCol < 10; iCol++) {
		cols[iCol].respace();
	}
}

//-----------------------------------------------------------------------------
// help
//-----------------------------------------------------------------------------
function hideHelp() {
	document.getElementById('help-all').style.display = 'none';
}

function showHelp() {
	var e = document.getElementById('help-all');
	if (e.style.display == 'block') e.style.display = 'none';
	else                            e.style.display = 'block';
}

//-----------------------------------------------------------------------------
// mouse event handlers
//-----------------------------------------------------------------------------
function mouseUp(ev){
	//logScreen('Enter mouseUp');
	if (ddrop) {
		ddrop.mouseUp(ev);
		//console.log('delete ddrop');
	}
	ddrop = undefined;
	//logScreen('Exit mouseUp');
}

function mouseMove(ev){
	if (ddrop) ddrop.mouseMove(ev);
}

function mouseDown(ev){
	//logScreen('Enter mouseDown');
	if (!ddrop) ddrop = new DragDrop(ev);
	//logScreen('Exit mouseDown');
}

function logScreen(msg) {
	var eLog = document.getElementById('logdebug');
	eLog.appendChild(document.createElement('BR'));
	eLog.appendChild(document.createTextNode(msg));
}

	</script>
</head>
<body onload="initA();">
&nbsp;
<div id="bkground">
<div id="logdebug">&nbsp;</div>
<div id="deal" class="but" onclick="dealRow()">Deal row</div>
<div id="new"  class="but" onclick="newGame()">New game</div>
<div id="elapsed" class="topinfo">0 s</div>
<div id="moves" class="topinfo">0 move</div>
<div id="save" class="but" onclick="saveGame()">Save</div>
<div id="restore" class="but" onclick="restoreButton()">Restore</div>
<div id="undo" class="but" onclick="oUndo.undoGame()">Undo</div>
<div id="help" class="but" onclick="showHelp()">Help</div>
<div id="dealt"  class="topinfo"></div>
<div id="easydiv"><input type="checkbox" id="easyChk" /><br /><label for="easyChk">Easy</label></div>
<div id="col0" class="column"></div>
<div id="col1" class="column"></div>
<div id="col2" class="column"></div>
<div id="col3" class="column"></div>
<div id="col4" class="column"></div>
<div id="col5" class="column"></div>
<div id="col6" class="column"></div>
<div id="col7" class="column"></div>
<div id="col8" class="column"></div>
<div id="col9" class="column"></div>
<div id="suit0" class="terminatedSuit">x</div>
<div id="suit1" class="terminatedSuit">x</div>
<div id="suit2" class="terminatedSuit">x</div>
<div id="suit3" class="terminatedSuit">x</div>
<div id="suit4" class="terminatedSuit">x</div>
<div id="suit5" class="terminatedSuit">x</div>
<div id="suit6" class="terminatedSuit">x</div>
<div id="suit7" class="terminatedSuit">x</div>
<div id="win" >x</div>
<div id="help-all" onclick="hideHelp()">
	<div id="help-close">X</div>
	<div id="help-en">
Help not available in English. Please, help.
	</div>
	<div id="help-fr">
<ul>
<li>Le but est de reconstituer les 8 couleurs dans l'ordre Roi => As.</li>
<li>On ne peut déplacer que des blocs consécutifs dans la même couleur.</li>
<li>On ne peut amener un bloc que sous une carte de valeur juste au-dessus de la première carte du bloc (pas nécessairement de la même couleur) ou vers une colonne vide.</li>
<li>Cliquer sur une colonne pour déplacer un bloc vers une destination possible. Le bloc flashe s'il n'y a pas de destination acceptable.</li>
<li>Une suite complète sera envoyée dans la zone de stockage (cases en haut) et enlevée du tapis, s'il n'y a pas de colonne vide. Il y a un bonus pour une partie gagnée sans utiliser la zone de stockage.</li>
<li>Il est possible aussi d'amener un bloc vers un endroit possible en le déplaçant avec la souris.</li>
<li>Il est possible de couper un bloc constitué. Pour cela, cliquer avec le deuxième bouton de la souris (bouton de droite pour les droitiers) à l'endroit où l'on souhaite opérer la séparation.</li>
<li>Le bouton «Deal row» permet de distribuer une nouvelle carte sur chaque colonne. Il faudra distribuer 5 fois pour amener la totalité des 2 jeux de 52 cartes sur le tapis.</li>
<li>Le bouton «Undo» permet d'annuler les déplacements précédents. S'il n'est pas possible d'annuler, ce bouton est grisé. Il n'est pas possible d'annuler si&nbsp;:
<ul>
<li>Un déplacement a révélé une carte.</li>
<li>Une distribution vient d'avoir lieu.</li>
<li><i>Il est possible d'annuler si on vient de lancer par erreur une nouvelle partie. Dans ce cas, la partie précédente est affichée là où elle en était. La nouvelle partie est irrémédiablement perdue.</i></li>
</ul></li>
<li>Il y a un bonus pour une partie gagnée sans valider de couleur. Et encore plus si une suite se trouve sur une autre suite.</li>
<li>Le mode «Easy» (facile) a les caractéristiques suivantes&nbsp;:
<ul>
<li>Utilisation de 4 x 2 couleurs (cœur et pique) au lieu de 2 x 4 couleurs.</li>
<li>Possibilité d'annuler même après avoir révélé une carte.</li>
</ul></li>
</ul>
	</div>
</div>
</div>
</body>
</html>
